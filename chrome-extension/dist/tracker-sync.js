"use strict";(()=>{var o="[FT-sync]",r="filament-tracker-stock";var a=null;console.log(o,"Content script loaded on",window.location.href);function t(){let e=localStorage.getItem(r);if(!e){console.log(o,`No "${r}" key in localStorage \u2014 nothing to sync`);return}console.log(o,`Found stock data (${e.length} chars), parsing...`);try{let n=JSON.parse(e);if(n.version!==2||!Array.isArray(n.entries)){console.warn(o,"Stock data has wrong shape \u2014 version:",n.version);return}console.log(o,`Sending STOCK_SYNC with ${n.entries.length} entries to service worker`);let s={type:"STOCK_SYNC",stockData:n};chrome.runtime.sendMessage(s,c=>{chrome.runtime.lastError?console.error(o,"sendMessage failed:",chrome.runtime.lastError.message):(a=e,console.log(o,"Service worker responded:",c))})}catch(n){console.error(o,"Failed to parse stock data:",n)}}t();window.addEventListener("storage",e=>{e.key===r&&(console.log(o,"localStorage changed, re-syncing..."),t())});setInterval(()=>{let e=localStorage.getItem(r);e&&e!==a&&(console.log(o,"Polling detected change, re-syncing..."),t())},5e3);chrome.runtime.onMessage.addListener((e,n,s)=>{e.type==="TRIGGER_SYNC"&&(console.log(o,"TRIGGER_SYNC received from popup"),t(),s({ok:!0}))});})();
